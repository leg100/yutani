{
  "module": {
  },
  "resource": {
    "aws_instance": {
      "nginx": {
        "instance_type": "t2.nano",
        "vpc_security_group_ids": [
          "${aws_security_group.instance.id}"
        ],
        "ami": null,
        "key_name": "louisgarman",
        "tags": {
          "Name": "-nginx-dev",
          "Role": "nginx",
          "Environment": "dev"
        }
      }
    },
    "aws_security_group": {
      "instance": {
        "name": "nginx-dev",
        "description": "Security group for the nginx instance",
        "vpc_id": "${var.aws_vpc.main.id}"
      },
      "elb": {
        "name": "-dev-nginx-elb",
        "vpc_id": "${var.aws_vpc.main.id}",
        "description": "Security group for elb of the nginx cluster"
      }
    },
    "aws_security_group_rule": {
      "instance_http_from_elb": {
        "type": "ingress",
        "security_group_id": "${aws_security_group.instance.id}",
        "source_security_group_id": "${aws_security_group.elb.id}",
        "from_port": 80,
        "to_port": 80,
        "protocol": "tcp"
      },
      "instance_ssh_from_bastion": {
        "type": "ingress",
        "security_group_id": "${aws_security_group.instance.id}",
        "source_security_group_id": "${var.aws_security_group.bastion.id}",
        "from_port": 22,
        "to_port": 22,
        "protocol": "tcp"
      },
      "elb_http_from_public": {
        "type": "ingress",
        "security_group": "${aws_security_group.elb.id}",
        "cidr_blocks": [
          "0.0.0.0/0"
        ],
        "from_port": 80,
        "to_port": 80,
        "protocol": "tcp"
      },
      "elb_http_to_instance": {
        "type": "egress",
        "security_group": "${aws_security_group.elb.id}",
        "source_security_group_id": "${aws_security_group.instance.id}",
        "from_port": 80,
        "to_port": 80,
        "protocol": "tcp"
      }
    },
    "aws_elb": {
      "nginx": {
        "name": "-dev-nginx",
        "subnets": [
          "${var.aws_subnet.public_eu-west-1a.id}",
          "${var.aws_subnet.public_eu-west-1b.id}",
          "${var.aws_subnet.public_eu-west-1c.id}"
        ],
        "cross_zone_load_balancing": true,
        "connection_draining": true,
        "internal": false,
        "security_groups": [
          "${aws_security_group.elb.id}"
        ],
        "tags": {
          "Name": "-dev-nginx",
          "Project": null,
          "Env": "dev",
          "Role": "nginx"
        },
        "listener": {
          "instance_port": 80,
          "instance_protocol": "http",
          "lb_port": 80,
          "lb_protocol": "http"
        },
        "health_check": {
          "healthy_threshold": 2,
          "unhealthy_threshold": 2,
          "timeout": 2,
          "target": "HTTP:80/",
          "interval": 5
        },
        "lifecycle": {
          "create_before_destroy": true
        }
      }
    }
  },
  "output": {
  },
  "variables": {
    "vpc.aws_vpc.main.id": {
    },
    "bastion.aws_security_group.bastion.id": {
    },
    "vpc.aws_subnet.public_eu-west-1a.id": {
    },
    "vpc.aws_subnet.public_eu-west-1b.id": {
    },
    "vpc.aws_subnet.public_eu-west-1c.id": {
    }
  }
}